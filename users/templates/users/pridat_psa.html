{% extends 'home/base.html' %}

{% block content %}
<style>
    .section-title {
        color: #8B4513;
        font-weight: bold;
        margin-top: 30px;
        margin-bottom: 15px;
        border-bottom: 2px solid #f1ede4;
        padding-bottom: 5px;
    }

    .field-container { margin-bottom: 20px; }
    .field-container label { font-weight: 600; color: #5d4037; display: block; margin-bottom: 5px; }

    /* Stylov√°n√≠ input≈Ø aby ladily k designu */
    .field-container input, .field-container select, .field-container textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 10px;
    }

    .missing-mode-box {
        background-color: #fff5f5;
        border: 2px solid #feb2b2;
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 25px;
    }

    /* Styl pro zamƒçen√° pole */
    .premium-lock-overlay {
        background-color: rgba(255, 255, 255, 0.6);
        border: 1px dashed #c5a059;
        border-radius: 15px;
        padding: 20px;
        position: relative;
        text-align: center;
    }
    .lock-icon { color: #c5a059; font-size: 1.2rem; margin-bottom: 10px; }

    .btn-brown:hover { background-color: #6F370F !important; }
</style>

<div class="container" style="max-width: 700px; margin-top: 20px; margin-bottom: 50px;">

    {# Horn√≠ info pro verzi zdarma #}
    {% if not request.user.profil.je_premium %}
    <div class="alert shadow-sm mb-4 d-flex align-items-center" style="border-radius: 15px; border: none; background-color: #fff3cd; color: #856404;">
        <span style="font-size: 1.5rem; margin-right: 15px;">üí°</span>
        <div>
            <strong>Tip:</strong> S Premium verz√≠ m≈Ø≈æete p≈ôidat neomezenƒõ ps≈Ø a z√≠skat profi rodokmen.
        </div>
    </div>
    {% endif %}

    <div class="card shadow-sm border-0" style="background-color: #fdfaf5; border-radius: 25px; padding: 30px;">
        <h2 style="color: #8B4513; text-align: center; margin-bottom: 5px; font-weight: bold;">
            {% if editace %}‚öôÔ∏è √öprava profilu{% else %}üêï Nov√Ω par≈•√°k{% endif %}
        </h2>
        <p class="text-center text-muted mb-4 small">Vypl≈àte √∫daje o va≈°em pejskovi</p>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            {# 1. NOUZOV√ù RE≈ΩIM (V≈ædy naho≈ôe) #}
            <div class="missing-mode-box shadow-sm">
                <div class="form-check form-switch d-flex justify-content-between align-items-center p-0">
                    <div style="padding-left: 10px;">
                        <label class="form-check-label fw-bold text-danger mb-0" for="{{ form.je_ztraceny.id_for_label }}">
                            üö® RE≈ΩIM "HLED√Å SE"
                        </label>
                        <small class="d-block text-muted">Aktivujte jen v p≈ô√≠padƒõ ztr√°ty!</small>
                    </div>
                    <div style="transform: scale(1.6); padding-right: 15px;">
                        {{ form.je_ztraceny }}
                    </div>
                </div>
            </div>

            <h4 class="section-title">üìç Z√°kladn√≠ √∫daje</h4>

            <div class="row">
                <div class="col-md-6 field-container">
                    <label>{{ form.jmeno.label }}</label>
                    {{ form.jmeno }}
                </div>
                <div class="col-md-6 field-container">
                    <label>Vƒõk (roky)</label>
                    {{ form.vek }}
                </div>
            </div>

            <div class="field-container">
                <label>{{ form.rasa.label }}</label>
                {{ form.rasa }}
            </div>

            {# BOX PRO NOV√â PLEMENO (Zobraz√≠ se p≈ôes JS) #}
            <div id="extra-plemeno-div" style="background-color: #f1ede4; padding: 20px; border-radius: 18px; margin-bottom: 25px; display: none;">
                <label style="font-weight: bold;">‚ú® Jin√© plemeno:</label>
                <input type="text" name="nove_plemeno" class="form-control" placeholder="Nap≈ô. Maru≈àsk√Ω teri√©r">
            </div>

            <div class="field-container">
                <label>{{ form.fotka.label }}</label>
                {{ form.fotka }}
            </div>

            <div class="field-container">
                <label>{{ form.cip.label }} (povinn√©)</label>
                {{ form.cip }}
            </div>

            {# 2. PREMIUM SEKCE: ZDRAV√ç A RODOKMEN #}
            <h4 class="section-title">
                üß¨ Zdrav√≠ a Rodokmen
                {% if not request.user.profil.je_premium %} <small>üîí</small> {% endif %}
            </h4>

            {% if request.user.profil.je_premium %}
                <div class="row">
                    <div class="col-md-6 field-container">
                        <label>{{ form.rtg_hd.label }}</label>
                        {{ form.rtg_hd }}
                    </div>
                    <div class="col-md-6 field-container">
                        <label>{{ form.rtg_ed.label }}</label>
                        {{ form.rtg_ed }}
                    </div>
                </div>
                <div class="field-container">
                    <label>{{ form.genetika_dna.label }}</label>
                    {{ form.genetika_dna }}
                </div>

                <h4 class="section-title">üå≥ P≈ôedci (pro rodokmen)</h4>
                <div class="row">
                    <div class="col-md-6 field-container">
                        <label>{{ form.otec.label }}</label>
                        {{ form.otec }}
                    </div>
                    <div class="col-md-6 field-container">
                        <label>{{ form.matka.label }}</label>
                        {{ form.matka }}
                    </div>
                </div>
            {% else %}
                <div class="premium-lock-overlay shadow-sm">
                    <div class="lock-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <p class="mb-2 text-dark fw-bold">Pr√©miov√© funkce jsou uzamƒçeny</p>
                    <p class="small text-muted mb-3">
                        Pole pro RTG v√Ωsledky, DNA testy a rodokmen jsou dostupn√© pouze v Premium verzi.
                    </p>
                    <a href="{% url 'cenik' %}" class="btn btn-sm btn-outline-warning rounded-pill">Aktivovat Premium</a>
                </div>
            {% endif %}

            <button type="submit" class="btn btn-brown w-100 py-3 fw-bold shadow-sm mt-4"
                    style="background-color: #8B4513; color: white; border-radius: 15px; font-size: 1.1rem; border: none;">
                {% if editace %}Ulo≈æit zmƒõny{% else %}P≈ôidat pejska{% endif %}
            </button>

            <a href="{% url 'seznam_psu' %}" class="btn btn-link w-100 mt-2 text-decoration-none" style="color: #6c757d; text-align: center; display: block;">
                Zru≈°it a zpƒõt na seznam
            </a>
        </form>
    </div>
</div>

<script>
    // Jednoduch√Ω skript pro zobrazen√≠ pole pro vlastn√≠ plemeno, pokud je vybr√°no "Jin√©"
    document.addEventListener('DOMContentLoaded', function() {
        const rasaSelect = document.querySelector('[name="rasa"]');
        const extraDiv = document.getElementById('extra-plemeno-div');

        if (rasaSelect) {
            rasaSelect.addEventListener('change', function() {
                if (this.value === 'jine') { // P≈ôedpokl√°d√°m, ≈æe v selectu m√°≈° hodnotu 'jine'
                    extraDiv.style.display = 'block';
                } else {
                    extraDiv.style.display = 'none';
                }
            });
        }
    });
</script>

{% endblock %}