{% extends 'home/base.html' %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold" style="color: var(--primary-brown); font-family: 'Playfair Display', serif;">üêæ Moji psi</h2>
        <a href="{% url 'pridat_psa' %}" class="btn text-white px-4 shadow-sm fw-bold"
           style="background-color: var(--primary-brown); border-radius: 15px; transition: 0.3s;">
            <i class="fas fa-plus-circle me-1"></i> P≈ôidat pejska
        </a>
    </div>

    <div class="row g-4">
        {% for pes in psi %}
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm border-0 h-100 {% if pes.je_ztraceny %}border border-danger border-3 animate-pulse{% endif %}"
                 style="border-radius: 25px; overflow: hidden; background: white;">

                {% if pes.je_ztraceny %}
                <div class="bg-danger text-white text-center py-1 fw-bold small shadow-sm"
                     style="position: absolute; width: 100%; z-index: 10; letter-spacing: 1px;">
                    üö® HLED√Å SE / ZTRACEN√ù
                </div>
                {% endif %}

                <div style="height: 220px; background-color: #f8f5f0; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer;"
                     data-bs-toggle="modal" data-bs-target="#modalFoto{{ pes.pk }}">
                    {% if pes.fotka %}
                    <img src="{{ pes.fotka.url }}" style="width: 100%; height: 100%; object-fit: cover;" alt="{{ pes.jmeno }}">
                    {% else %}
                    <div class="text-muted" style="font-size: 4rem;">üêï</div>
                    {% endif %}
                </div>

                <div class="card-body d-flex flex-column p-4">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h3 class="fw-bold mb-0">
                            <a href="{% url 'detail_psa' pes.pk %}" class="text-decoration-none text-dark hover-brown">
                                {{ pes.jmeno }}
                            </a>
                        </h3>
                        <span class="badge rounded-pill bg-light text-dark border px-3 py-2 shadow-sm">{{ pes.vek }} let</span>
                    </div>
                    <p class="text-muted mb-3"><i class="fas fa-paw me-1"></i> {{ pes.rasa }}</p>

                    <div class="d-flex align-items-center p-3 mb-3 border rounded-4 bg-light shadow-inner">
                        {% if pes.qr_kod %}
                        <img src="{{ pes.qr_kod.url }}" style="width: 55px; height: 55px;" class="me-3 rounded shadow-sm border bg-white">
                        <div style="font-size: 0.8rem; line-height: 1.3;">
                            <span class="fw-bold d-block text-uppercase text-secondary" style="font-size: 0.65rem;">Digit√°ln√≠ zn√°mka</span>
                            <a href="{{ pes.qr_kod.url }}" download class="fw-bold text-primary text-decoration-none">
                                <i class="fas fa-download me-1"></i> St√°hnout QR
                            </a>
                        </div>
                        {% else %}
                        <small class="text-muted"><i class="fas fa-sync fa-spin me-1"></i> Generuji QR...</small>
                        {% endif %}
                    </div>

                    <div class="p-3 mb-4" style="background-color: #fdfaf5; border-radius: 20px; border: 1px solid rgba(0,0,0,0.05);">
                        <div class="d-flex justify-content-between small mb-2">
                            <span class="text-secondary">üíâ Dal≈°√≠ vakc√≠na:</span>
                            <span class="fw-bold text-primary">{{ pes.pristi_ockovani|date:"d.m.Y"|default:"--" }}</span>
                        </div>
                        <div class="d-flex justify-content-between small">
                            <span class="text-secondary">üíä Odƒçerven√≠:</span>
                            <span class="fw-bold text-success">{{ pes.pristi_odcerveni|date:"d.m.Y"|default:"--" }}</span>
                        </div>
                    </div>

                    <div class="d-grid gap-2 mb-3 mt-auto">
                        <a href="{% url 'detail_psa' pes.pk %}" class="btn fw-bold shadow-sm py-2"
                           style="background-color: #ffc107; color: #5d4037; border-radius: 15px; border: none;">
                            üîç PROHL√âDNOUT PROFIL & RODOKMEN
                        </a>
                    </div>

                    <div class="d-grid gap-2">
                        <div class="d-flex gap-2">
                            <a href="{% url 'upravit_psa' pes.pk %}"
                               class="btn btn-sm btn-outline-secondary flex-grow-1" style="border-radius: 12px; padding: 8px;">
                                <i class="fas fa-edit me-1"></i> Upravit
                            </a>
                            <a href="{% url 'smazat_psa' pes.pk %}" class="btn btn-sm btn-outline-danger"
                               style="border-radius: 12px; padding: 8px 15px;">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalFoto{{ pes.pk }}" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content bg-transparent border-0">
                    <div class="modal-body p-0 text-center position-relative">
                        <button type="button" class="btn-close btn-close-white position-absolute"
                                style="top: 20px; right: 20px; z-index: 100; background-color: rgba(0,0,0,0.5); padding: 10px; border-radius: 50%; opacity: 1;"
                                data-bs-dismiss="modal"></button>
                        {% if pes.fotka %}
                        <img src="{{ pes.fotka.url }}" class="img-fluid shadow-lg rounded-4" style="max-height: 85vh;">
                        <h4 class="text-white mt-3 fw-bold" style="text-shadow: 2px 2px 10px rgba(0,0,0,0.8);">{{ pes.jmeno }}</h4>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5 shadow-sm rounded-4 bg-white border border-dashed">
            <div style="font-size: 4rem;">ü¶Æ</div>
            <h4 class="text-muted mt-3">Zat√≠m jste nep≈ôidali ≈æ√°dn√©ho pejska.</h4>
            <a href="{% url 'pridat_psa' %}" class="btn btn-primary mt-3 px-4 rounded-pill">Vytvo≈ôit prvn√≠ profil</a>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .hover-brown:hover { color: var(--primary-brown) !important; }
    .shadow-inner { box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
    @keyframes pulse-border {
        0% { border-color: #dc3545; box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
        50% { border-color: #ffc107; box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); }
        100% { border-color: #dc3545; box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
    .animate-pulse { animation: pulse-border 2s infinite; }
</style>
{% endblock %}