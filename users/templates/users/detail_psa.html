{% extends 'home/base.html' %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    :root {
        --primary-brown: #5d4037;
        --accent-beige: #f8f5f2;
        --border-color: #e2d1c3;
    }

    body { font-family: 'Inter', sans-serif; background-color: #fdfcfb; }
    h2, h4 { font-family: 'Playfair Display', serif; color: var(--primary-brown); }

    /* Hlavní kontejner */
    .profi-card {
        background: white;
        border-radius: 20px;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        margin-bottom: 1.5rem;
    }

    /* Prevence boxy */
    .prevence-item {
        background: var(--accent-beige);
        border-radius: 12px;
        padding: 0.8rem 1rem;
        text-decoration: none !important;
        display: block;
        margin-bottom: 0.8rem;
        transition: 0.3s;
        border: 1px solid transparent;
    }
    .prevence-item:hover { border-color: var(--primary-brown); transform: translateY(-2px); }

    /* Galerie - Flexibilní Grid */
    .gallery-grid {
        display: grid;
        /* Na počítači 3 sloupce, na tabletu 2, na mobilu 2 (aby nebyly obří) */
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
    }

    .gallery-item {
        height: 180px; /* Sjednocená výška */
        background: #fafafa;
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #eee;
    }

    .gallery-item img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain; /* Žádný ořez, vidíš celou fotku */
    }

    /* Mobilní úpravy */
    @media (max-width: 768px) {
        .gallery-grid { grid-template-columns: repeat(2, 1fr); }
        .gallery-item { height: 150px; }
        .display-mobile-column { flex-direction: column; }
    }
</style>

<div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'seznam_psu' %}" class="text-decoration-none text-muted fw-bold small">
            <i class="fas fa-chevron-left me-1"></i> ZPĚT
        </a>
        <a href="{% url 'upravit_psa' pes.pk %}" class="btn btn-sm text-white px-3" style="background: var(--primary-brown); border-radius: 8px;">
            <i class="fas fa-cog"></i>
        </a>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="profi-card p-4 text-center">
                {% if pes.fotka %}
                    <img src="{{ pes.fotka.url }}" class="rounded-circle mb-3 border shadow-sm" style="width: 120px; height: 120px; object-fit: cover;">
                {% endif %}
                <h2 class="fw-bold mb-0">{{ pes.jmeno }}</h2>
                <p class="text-muted small mb-4">{{ pes.rasa }}</p>

                <div class="text-start mt-4">
                    <h6 class="fw-bold small text-uppercase mb-3" style="letter-spacing: 1px; color: #a1887f;">Prevence</h6>

                    <a href="{% url 'upravit_psa' pes.pk %}" class="prevence-item">
                        <div class="d-flex justify-content-between">
                            <span class="small fw-bold text-dark">Vakcinace</span>
                            {% if pes.ockovani_propadle %}<i class="fas fa-exclamation-circle text-danger"></i>{% endif %}
                        </div>
                        <div class="small text-muted">{{ pes.pristi_ockovani|date:"d. m. Y" }}</div>
                    </a>

                    <a href="{% url 'upravit_psa' pes.pk %}" class="prevence-item">
                        <div class="d-flex justify-content-between">
                            <span class="small fw-bold text-dark">{{ pes.get_typ_ochrany_klistata_display|truncatechars:15 }}</span>
                            {% if pes.klistata_propadle %}<i class="fas fa-clock text-danger"></i>{% endif %}
                        </div>
                        <div class="small text-muted">Do: {{ pes.pristi_klistata|date:"d. m. Y" }}</div>
                    </a>

                    <a href="{% url 'upravit_psa' pes.pk %}" class="prevence-item">
                        <div class="d-flex justify-content-between">
                            <span class="small fw-bold text-dark">Odčervení</span>
                            {% if pes.odcerveni_propadle %}<i class="fas fa-pills text-danger"></i>{% endif %}
                        </div>
                        <div class="small text-muted">{{ pes.pristi_odcerveni|date:"d. m. Y" }}</div>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="profi-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold mb-0">Galerie</h4>
                    <button class="btn btn-outline-secondary btn-sm rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#modalMedia">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>

                <div class="gallery-grid">
                    {% for f in fotky %}
                    <div class="gallery-item position-relative shadow-sm">
                        <a href="{{ f.obrazek.url }}" data-lightbox="pes-gallery">
                            <img src="{{ f.obrazek.url }}">
                        </a>
                        {% if request.user.profil == pes.majitel %}
                        <form action="{% url 'smazat_foto' f.id %}" method="POST" class="position-absolute" style="top:5px; right:5px;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm rounded-circle p-0" style="width:22px; height:22px; font-size:10px;" onclick="return confirm('Smazat?')">
                                <i class="fas fa-times"></i>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                {% if videa %}
                <h4 class="fw-bold mt-5 mb-3">Videa</h4>
                <div class="row g-3">
                    {% for v in videa %}
                    <div class="col-md-6">
                        <div class="rounded-4 overflow-hidden border">
                            <video controls class="w-100 d-block"><source src="{{ v.video_soubor.url }}" type="video/mp4"></video>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalMedia" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4 border-0" style="border-radius: 20px;">
            <h5 class="fw-bold mb-3">Přidat fotku</h5>
            <form action="{% url 'pridat_foto' pes.id %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="obrazek" class="form-control mb-3" accept="image/*" required>
                <button class="btn w-100 py-2 text-white fw-bold" style="background: var(--primary-brown); border-radius: 10px;">NAHRÁT</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
{% endblock %}