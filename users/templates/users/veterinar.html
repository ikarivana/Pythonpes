{% extends 'home/base.html' %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    :root {
        --t-brown: #3e2723;
        --t-gold: #c5a059;
        --t-bg: #fdfaf4;
        --t-card: #fffdfa;
        --t-danger: #d63031;
        --t-success: #2d6a4f;
    }

    body { background-color: #f9f4ef; font-family: 'Plus Jakarta Sans', sans-serif; }

    /* --- BANNER --- */
    .term-header {
        background: linear-gradient(135deg, #4e342e 0%, #795548 100%);
        border-radius: 40px;
        padding: 60px 40px;
        color: white;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
        box-shadow: 0 15px 35px rgba(78, 52, 46, 0.2);
        border-bottom: 6px solid var(--t-gold);
    }

    /* --- KARTY PSA --- */
    .dog-term-card {
        background: var(--t-card);
        border-radius: 35px;
        border: 1px solid rgba(197, 160, 89, 0.2);
        box-shadow: 0 12px 30px rgba(0,0,0,0.04);
        margin-bottom: 20px;
        overflow: hidden;
        transition: 0.3s ease;
        height: 100%;
    }

    .dog-name-bar {
        background: rgba(197, 160, 89, 0.08);
        padding: 20px 25px;
        display: flex; justify-content: space-between; align-items: center;
    }

    /* ZDRAVOTN√ç ODZNAKY V KARTƒö */
    .health-badge-mini {
        background: #fffcf5; border: 1px solid #f0e6d2; border-radius: 15px; padding: 10px 5px;
        text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center;
    }
    .health-badge-mini i { font-size: 1rem; color: var(--t-gold); margin-bottom: 5px; }
    .date-main { display: block; font-weight: 800; font-size: 0.8rem; color: var(--t-brown); }
    .date-sub { font-size: 0.6rem; color: var(--t-success); font-weight: 700; text-transform: uppercase; }

    /* --- ZDRAVOTN√ç DEN√çK --- */
    .vet-report-section {
        background: white; border-radius: 35px; border: 2px solid var(--t-gold);
        padding: 30px; margin-top: 40px; box-shadow: 0 15px 40px rgba(197, 160, 89, 0.1);
    }

    .incident-card {
        background: #fdfcfb; border-radius: 22px; padding: 20px;
        border-left: 6px solid var(--t-gold); margin-bottom: 15px;
        display: flex; gap: 15px; align-items: center; position: relative;
    }

    .qr-container { width: 80px; flex-shrink: 0; text-align: center; }

    .action-icons { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; }
    .action-icons a, .action-icons button { color: #adb5bd; background: none; border: none; font-size: 0.8rem; }

    .btn-lux-add {
        background: var(--t-gold); color: white; border-radius: 18px; border: none;
        font-weight: 800; padding: 12px 25px; text-transform: uppercase; font-size: 0.8rem;
    }

    @media (max-width: 576px) {
        .term-header { padding: 30px 20px; border-radius: 0 0 30px 30px; }
        .dog-name-bar { padding: 15px; }
    }
</style>

<div class="container py-2 pb-5">
    <div class="term-header text-center text-md-start">
        <div class="row align-items-center">
            <div class="col-md-7">
                <h1 style="font-family: 'Playfair Display', serif; font-size: 2.5rem;" class="mb-2">Den√≠k hrdin≈Ø üêæ</h1>
                <p class="fs-6 opacity-75 mb-0">Kompletn√≠ l√©ka≈ôsk√° slo≈æka pro va≈°eho veterin√°≈ôe.</p>
            </div>
            <div class="col-md-5 text-md-end mt-3 mt-md-0">
                <div class="p-3 bg-white bg-opacity-10 d-inline-block rounded-4 border border-white border-opacity-20">
                    <span class="fw-bold fs-4">{{ psi.count }}</span>
                    <small class="text-uppercase d-block" style="font-size: 0.5rem;">Psi v p√©ƒçi</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-2">
        {% for pes in psi %}
        <div class="col-lg-6">
            <div class="dog-term-card">
                <div class="dog-name-bar">
                    <h4 class="fw-bold m-0" style="color: var(--t-brown); font-family: 'Playfair Display', serif;">{{ pes.jmeno }}</h4>
                    <a href="{% url 'detail_psa' pes.id %}" class="btn btn-sm btn-outline-gold rounded-pill px-3">Detail</a>
                </div>

                <div class="p-3">
                    <div class="row g-2">
                        <div class="col-4">
                            <div class="health-badge-mini">
                                <i class="fas fa-syringe"></i>
                                <span class="date-main">{{ pes.pristi_ockovani|date:"d.m.Y"|default:"--" }}</span>
                                <span class="date-sub">Oƒçkov√°n√≠</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="health-badge-mini">
                                <i class="fas fa-bug"></i>
                                <span class="date-main">{{ pes.pristi_odcerveni|date:"d.m.Y"|default:"--" }}</span>
                                <span class="date-sub">Odƒçerven√≠</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="health-badge-mini">
                                <i class="fas fa-shield-virus"></i>
                                <span class="date-main">{{ pes.pristi_klistata|date:"d.m.Y"|default:"--" }}</span>
                                <span class="date-sub">Kl√≠≈°≈•ata</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="vet-report-section">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
            <div>
                <h3 class="fw-bold mb-1" style="color: var(--t-brown); font-family: 'Playfair Display', serif;">üö® Pohotovostn√≠ den√≠k pot√≠≈æ√≠</h3>
                <p class="text-muted mb-0 small">Zapi≈°te p≈ô√≠znaky pro rychl√Ω sken l√©ka≈ôem.</p>
            </div>
            <button class="btn btn-lux-add" data-bs-toggle="modal" data-bs-target="#newIncidentModal">
                <i class="fas fa-edit me-2"></i>Nov√Ω z√°znam
            </button>
        </div>

        <div class="row g-3">
            {% for zaznam in posledni_zaznamy %}
            <div class="col-md-6">
                <div class="incident-card shadow-sm" style="border-left-color: {% if zaznam.typ == 'urgentni' %}#d63031{% else %}#c5a059{% endif %};">

                    <div class="action-icons">
                        <a href="{% url 'upravit_zaznam' zaznam.pk %}"><i class="fas fa-pen"></i></a>
                        <form action="{% url 'smazat_zaznam' zaznam.pk %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" onclick="return confirm('Smazat?')"><i class="fas fa-trash"></i></button>
                        </form>
                    </div>

                    <div class="qr-container">
                        {% if zaznam.pes.qr_kod %}
                            <img src="{{ zaznam.pes.qr_kod.url }}" class="img-fluid rounded border shadow-sm">
                        {% endif %}
                        <small class="d-block mt-1 fw-bold" style="font-size: 0.5rem;">SOS SKEN</small>
                    </div>

                    <div class="flex-grow-1 pe-4">
                        <h6 class="fw-bold mb-0">{{ zaznam.titulek }}</h6>
                        <small class="text-muted">{{ zaznam.datum_vytvoreni|date:"d.m. H:i" }} | üêï {{ zaznam.pes.jmeno }}</small>
                        <p class="small text-muted mb-0 mt-1">{{ zaznam.popis|truncatechars:80 }}</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5 opacity-50">
                <p>Zat√≠m ≈æ√°dn√© z√°znamy.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="modal fade" id="newIncidentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0" style="border-radius: 30px;">
            <form method="POST" action="{% url 'veterinar' %}">
                {% csrf_token %}
                <div class="modal-body p-4">
                    <h4 class="fw-bold mb-4">Nov√Ω zdravotn√≠ z√°znam</h4>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase">Pejsek</label>
                        <select name="pes_id" class="form-select rounded-4 border-light bg-light" required>
                            {% for pes in psi %}
                            <option value="{{ pes.id }}">{{ pes.jmeno }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase">V√°≈ænost</label>
                        <select name="typ" class="form-select rounded-4 border-light bg-light">
                            <option value="zaznam">üìù Bƒõ≈æn√Ω z√°znam</option>
                            <option value="urgentni">üö® Urgentn√≠</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase">Titulek</label>
                        <input type="text" name="titulek" class="form-control rounded-4 border-light bg-light" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase">Popis</label>
                        <textarea name="popis" class="form-control rounded-4 border-light bg-light" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-lux-add w-100 py-3 mt-2 shadow-sm">Ulo≈æit z√°znam</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}